MODULE COLORMAP

IMPLICIT NONE
INTEGER,PARAMETER:: CM_Rainbow=1,&
                    CM_RainBow_DarkEnds=2,&
                    CM_RainBowLight=3,&
                    CM_RainBowPastel=4,&
                    CM_Terrain=5,&
                    CM_Gray=6,&
                    CM_HotMetal=7,&
                    CM_Doppler=8,&
                    CM_Elevation=9,&
                    CM_Magma=10,&
                    CM_Accent=11,&
                    CM_Red=12,&
                    CM_Blue=13,&
                    CM_Green=14,&
                    CM_BlueRed=15,&
                    CM_BlueYellowRed=16,&
                    CM_HighPoint=17,&
                    CM_HighPoint2=18,&
                    CM_YellowHigh=19,&
                    CM_Soil=20,&
                    CM_Geology=21,&
                    CM_Land=22

										
LOGICAL::IsCMIni=.FALSE.

TYPE CM_RGBV_TYDEF
	CHARACTER(128)::NAME
	INTEGER::NCP=0
	REAL(4),ALLOCATABLE::RGBV(:,:)
ENDTYPE
TYPE(CM_RGBV_TYDEF)::DefaultRGBV(25)
INTEGER::nDefaultRGBV=22
INTEGER::ICOLORMAP=CM_RainBow

CONTAINS

SUBROUTINE GetValueColor(value,VMIN,VMAX,VCOLOR,iDefaultRGBV,CustomedRGBV)
!!http://andrewnoske.com/wiki/Code_-_heatmaps_and_color_gradients

    REAL(8),INTENT(IN)::VALUE,VMIN,VMAX   
    REAL(4),INTENT(OUT)::VCOLOR(3)
    INTEGER,INTENT(IN),OPTIONAL::iDefaultRGBV
    TYPE(CM_RGBV_TYDEF),INTENT(IN),OPTIONAL::CustomedRGBV
    TYPE(CM_RGBV_TYDEF)::RGBV
    
    INTEGER:: IDX1,IDX2,I
    REAL(8)::FRACTBETWEEN=0,V1,T1
   
   	
   
    IF(PRESENT(iDefaultRGBV)) THEN
        IF(iDefaultRGBV>0.AND.iDefaultRGBV<=nDefaultRGBV) THEN
        	IF(.NOT.ISCMINI) CALL DEFAULT_COLORMAP_INITIALIZE()
        	RGBV=DefaultRGBV(iDefaultRGBV)
        ENDIF
    ELSEIF(PRESENT(CustomedRGBV)) THEN
    		RGBV=CustomedRGBV
    ENDIF
    
    IF(RGBV.NCP==0) THEN
		IF(.NOT.ISCMINI) CALL DEFAULT_COLORMAP_INITIALIZE()
        RGBV=DefaultRGBV(CM_RainBow_DarkEnds)    
    ENDIF
   
    IF(ABS(VMAX-VMIN)>1E-8) THEN
        V1=(VALUE-VMIN)/(VMAX-VMIN)
    ELSE
        V1=VMIN
    ENDIF
    
    FRACTBETWEEN=0.0
    IF(V1<=0.D0) THEN
        IDX1=1;IDX2=1
    ELSEIF(V1>=1.D0) THEN
        IDX1=RGBV.NCP;IDX2=IDX1
    ELSE
		DO I=2,RGBV.NCP
		    IF(V1<=RGBV.RGBV(4,I).AND.V1>RGBV.RGBV(4,I-1))THEN
		    	IDX2=I;IDX1=I-1
		    	EXIT	    		
		    ENDIF
		ENDDO       
        FRACTBETWEEN=(V1-RGBV.RGBV(4,IDX1))/(RGBV.RGBV(4,IDX2)-RGBV.RGBV(4,IDX1))
    ENDIF
    
    
    
    DO I=1,3
        VCOLOR(I)=(RGBV.RGBV(I,IDX2)-RGBV.RGBV(I,IDX1))*FRACTBETWEEN+RGBV.RGBV(I,IDX1)
    ENDDO
   
   

ENDSUBROUTINE

SUBROUTINE DEFAULT_COLORMAP_INITIALIZE()
	
	INTEGER::I
    ALLOCATE(DefaultRGBV(CM_Rainbow).RGBV(4,5))
    ALLOCATE(DefaultRGBV(CM_RainBow_DarkEnds).RGBV(4,6))
    ALLOCATE(DefaultRGBV(CM_RainBowLight).RGBV(4,9))
    ALLOCATE(DefaultRGBV(CM_RainBowPastel).RGBV(4,8))
    ALLOCATE(DefaultRGBV(CM_Terrain).RGBV(4,21))
    ALLOCATE(DefaultRGBV(CM_Gray).RGBV(4,9))
    ALLOCATE(DefaultRGBV(CM_HotMetal).RGBV(4,5))
    ALLOCATE(DefaultRGBV(CM_Doppler).RGBV(4,5))
    ALLOCATE(DefaultRGBV(CM_Elevation).RGBV(4,6))
    ALLOCATE(DefaultRGBV(CM_Magma).RGBV(4,16))
    ALLOCATE(DefaultRGBV(CM_Accent).RGBV(4,7))
    ALLOCATE(DefaultRGBV(CM_Red).RGBV(4,7))
    ALLOCATE(DefaultRGBV(CM_Blue).RGBV(4,7))
    ALLOCATE(DefaultRGBV(CM_Green).RGBV(4,7))
    ALLOCATE(DefaultRGBV(CM_BlueRed).RGBV(4,7))
    ALLOCATE(DefaultRGBV(CM_BlueYellowRed).RGBV(4,7))
    ALLOCATE(DefaultRGBV(CM_HighPoint).RGBV(4,6))
    ALLOCATE(DefaultRGBV(CM_HighPoint2).RGBV(4,23))
    ALLOCATE(DefaultRGBV(CM_YellowHigh).RGBV(4,8))
    ALLOCATE(DefaultRGBV(CM_Soil).RGBV(4,6))
    ALLOCATE(DefaultRGBV(CM_Geology).RGBV(4,9))
    ALLOCATE(DefaultRGBV(CM_Land).RGBV(4,6))


	
	
	DefaultRGBV(CM_HotMetal).NAME="HotMetal"
	DefaultRGBV(CM_HotMetal).NCP=5
	DefaultRGBV(CM_HotMetal).RGBV=RESHAPE([0.0078431,0.0000000,0.0000000,0.0,&
	0.4980392,0.0000000,0.0000000,0.25,&
	1.0000000,0.0000000,0.0000000,0.5,&
	1.0000000,1.0000000,0.0000000,0.75,&
	1.0000000,1.0000000,1.0000000,1.0],(/4,5/))

	DefaultRGBV(CM_BlueRed).NAME="BlueRed"
	DefaultRGBV(CM_BlueRed).NCP=7
	DefaultRGBV(CM_BlueRed).RGBV=RESHAPE([0.1294118,0.4000000,0.6745098,0.0,&
	0.4039216,0.6627451,0.8117647,0.166666666666667,&
	0.8196078,0.8980392,0.9411765,0.333333333333333,&
	0.9686275,0.9686275,0.9686275,0.5,&
	0.9921569,0.8588235,0.7803922,0.666666666666667,&
	0.9372549,0.5411765,0.3843137,0.833333333333333,&
	0.6980392,0.0941176,0.1686275,1.0],([4,7]))

	DefaultRGBV(CM_BlueYellowRed).NAME="BlueYellowRed"
	DefaultRGBV(CM_BlueYellowRed).NCP=7
	DefaultRGBV(CM_BlueYellowRed).RGBV=RESHAPE([0.2705882,0.4588235,0.7058824,0.0,&
	0.5686275,0.7490196,0.8588235,0.166666666666667,&
	0.8784314,0.9529412,0.9725490,0.333333333333333,&
	1.0000000,1.0000000,0.7490196,0.5,&
	0.9960784,0.8784314,0.5647059,0.666666666666667,&
	0.9882353,0.5529412,0.3490196,0.833333333333333,&
	0.8431373,0.1882353,0.1529412,1.0],([4,7]))

	DefaultRGBV(CM_Doppler).NAME="Doppler"
	DefaultRGBV(CM_Doppler).NCP=5
	DefaultRGBV(CM_Doppler).RGBV=RESHAPE([0.0000000,1.0000000,1.0000000,0.0,&
	0.0000000,0.0000000,1.0000000,0.25,&
	0.0000000,0.0000000,0.0000000,0.5,&
	1.0000000,0.0000000,0.0000000,0.75,&
	1.0000000,0.0000000,0.0000000,1.0],([4,5]))

	DefaultRGBV(CM_RainBow_DarkEnds).NAME="RainBow_DarkEnds"
	DefaultRGBV(CM_RainBow_DarkEnds).NCP=6
	DefaultRGBV(CM_RainBow_DarkEnds).RGBV=RESHAPE([0.0000000,0.0000000,0.5098039,0.0,&
	0.0000000,0.0000000,1.0000000,0.2,&
	0.0000000,1.0000000,1.0000000,0.4,&
	1.0000000,1.0000000,0.0000000,0.6,&
	1.0000000,0.0000000,0.0000000,0.8,&
	0.5098039,0.0000000,0.0000000,1.0],([4,6]))

	DefaultRGBV(CM_Magma).NAME="Magma"
	DefaultRGBV(CM_Magma).NCP=16
	DefaultRGBV(CM_Magma).RGBV=RESHAPE([0.0000000,1.0000000,1.0000000,0.0,&
	0.0000000,0.8000000,1.0000000,0.0666666666666667,&
	0.0000000,0.6000000,1.0000000,0.133333333333333,&
	0.0000000,0.4980392,1.0000000,0.2,&
	0.0000000,0.0000000,1.0000000,0.266666666666667,&
	0.3490196,0.0000000,0.7490196,0.333333333333333,&
	0.5529412,0.0000000,0.5529412,0.4,&
	0.8470588,0.0000000,0.2470588,0.466666666666667,&
	1.0000000,0.0000000,0.0000000,0.533333333333333,&
	1.0000000,0.4470588,0.0000000,0.6,&
	1.0000000,0.6470588,0.0000000,0.666666666666667,&
	1.0000000,0.8000000,0.0000000,0.733333333333333,&
	1.0000000,0.8980392,0.0000000,0.8,&
	1.0000000,1.0000000,0.0000000,0.866666666666667,&
	1.0000000,1.0000000,0.6980392,0.933333333333333,&
	1.0000000,1.0000000,1.0000000,1.0],([4,16]))

	DefaultRGBV(CM_Red).NAME="Red"
	DefaultRGBV(CM_Red).NCP=7
	DefaultRGBV(CM_Red).RGBV=RESHAPE([0.9960784,0.8980392,0.8509804,0.0,&
	0.9882353,0.7333333,0.6313725,0.166666666666667,&
	0.9882353,0.5725490,0.4470588,0.333333333333333,&
	0.9843137,0.4156863,0.2901961,0.5,&
	0.9372549,0.2313725,0.1725490,0.666666666666667,&
	0.7960784,0.0941176,0.1137255,0.833333333333333,&
	0.6000000,0.0000000,0.0509804,1.0],([4,7]))

	DefaultRGBV(CM_Blue).NAME="Blue"
	DefaultRGBV(CM_Blue).NCP=7
	DefaultRGBV(CM_Blue).RGBV=RESHAPE([0.9372549,0.9529412,1.0000000,0.0,&
	0.7764706,0.8588235,0.9372549,0.166666666666667,&
	0.6196078,0.7921569,0.8823529,0.333333333333333,&
	0.4196078,0.6823529,0.8392157,0.5,&
	0.2588235,0.5725490,0.7764706,0.666666666666667,&
	0.1294118,0.4431373,0.7098039,0.833333333333333,&
	0.0313725,0.2705882,0.5803922,1.0],([4,7]))

	DefaultRGBV(CM_Blue).NAME="Blue"
	DefaultRGBV(CM_Blue).NCP=7
	DefaultRGBV(CM_Blue).RGBV=RESHAPE([0.9372549,0.9529412,1.0000000,0.0,&
	0.7764706,0.8588235,0.9372549,0.166666666666667,&
	0.6196078,0.7921569,0.8823529,0.333333333333333,&
	0.4196078,0.6823529,0.8392157,0.5,&
	0.2588235,0.5725490,0.7764706,0.666666666666667,&
	0.1294118,0.4431373,0.7098039,0.833333333333333,&
	0.0313725,0.2705882,0.5803922,1.0],([4,7]))

	DefaultRGBV(CM_Green).NAME="Green"
	DefaultRGBV(CM_Green).NCP=7
	DefaultRGBV(CM_Green).RGBV=RESHAPE([0.9294118,0.9725490,0.9137255,0.0,&
	0.7803922,0.9137255,0.7529412,0.166666666666667,&
	0.6313725,0.8509804,0.6078431,0.333333333333333,&
	0.6313725,0.7686275,0.4627451,0.5,&
	0.2549020,0.6705882,0.3647059,0.666666666666667,&
	0.1372549,0.5450980,0.2705882,0.833333333333333,&
	0.0000000,0.3529412,0.1960784,1.0],([4,7]))

	DefaultRGBV(CM_Elevation).NAME="Elevation"
	DefaultRGBV(CM_Elevation).NCP=6
	DefaultRGBV(CM_Elevation).RGBV=RESHAPE([0.0000000,0.5137255,0.2039216,0.0,&
	0.2000000,0.8000000,0.0000000,0.2,&
	0.9568627,0.9411765,0.4392157,0.4,&
	0.9568627,0.7411765,0.2705882,0.6,&
	0.6000000,0.3921569,0.1647059,0.8,&
	1.0000000,1.0000000,1.0000000,1.0],([4,6]))

	DefaultRGBV(CM_Accent).NAME="Accent"
	DefaultRGBV(CM_Accent).NCP=7
	DefaultRGBV(CM_Accent).RGBV=RESHAPE([0.4980392,0.7882353,0.4980392,0.0,&
	0.7450980,0.6823529,0.8313725,0.166666666666667,&
	0.9921569,0.7529412,0.5254902,0.333333333333333,&
	1.0000000,1.0000000,0.6000000,0.5,&
	0.2196078,0.4235294,0.6901961,0.666666666666667,&
	0.9411765,0.0078431,0.4980392,0.833333333333333,&
	0.7490196,0.3568627,0.0901961,1.0],([4,7]))

	DefaultRGBV(CM_Gray).NAME="Gray"
	DefaultRGBV(CM_Gray).NCP=9
	DefaultRGBV(CM_Gray).RGBV=RESHAPE([0.0000000,0.0000000,0.0000000,0.0,&
	0.1254902,0.1254902,0.1254902,0.125,&
	0.2509804,0.2509804,0.2509804,0.25,&
	0.3764706,0.3764706,0.3764706,0.375,&
	0.5019608,0.5019608,0.5019608,0.5,&
	0.6274510,0.6274510,0.6274510,0.625,&
	0.7529412,0.7529412,0.7529412,0.75,&
	0.8784314,0.8784314,0.8784314,0.875,&
	1.0000000,1.0000000,1.0000000,1.0],([4,9]))

	DefaultRGBV(CM_Rainbow).NAME="Rainbow"
	DefaultRGBV(CM_Rainbow).NCP=5
	DefaultRGBV(CM_Rainbow).RGBV=RESHAPE([0.0000000,0.0000000,1.0000000,0.0,&
	0.0000000,1.0000000,1.0000000,0.25,&
	0.0000000,1.0000000,0.0000000,0.5,&
	1.0000000,1.0000000,0.0000000,0.75,&
	1.0000000,0.0000000,0.0000000,1.0],([4,5]))
    
    DefaultRGBV(CM_HighPoint).NAME="HighPoint"
    DefaultRGBV(CM_HighPoint).NCP=6
    DefaultRGBV(CM_HighPoint).RGBV=RESHAPE([0.0000000,0.0000000,0.0000000,0.0000000,&
    0.4000000,0.4000000,1.0000000,0.7000000,&
    0.0000000,0.2000000,0.6000000,0.7880000,&
    0.2000000,0.4000000,0.4000000,0.8500000,&
    1.0000000,1.0000000,0.0000000,0.9300000,&
    1.0000000,0.0000000,0.0000000,1.0000000],([4,6]))

    DefaultRGBV(CM_YellowHigh).NAME="YellowHigh"
    DefaultRGBV(CM_YellowHigh).NCP=8
    DefaultRGBV(CM_YellowHigh).RGBV=RESHAPE([0.5215686,0.6823529,0.8392157,0.0000000,&
    0.1254902,0.1647059,0.5058824,0.1855670,&
    0.0000000,0.0000000,0.4000000,0.3210942,&
    0.8000000,0.6000000,0.2000000,0.4089347,&
    0.6000000,0.0000000,0.0000000,0.5017182,&
    0.7137255,0.1137255,0.0000000,0.6529210,&
    1.0000000,0.4000000,0.0000000,0.8178694,&
    1.0000000,1.0000000,0.0000000,1.0000000],([4,8]))

    DefaultRGBV(CM_Soil).NAME="Soil"
    DefaultRGBV(CM_Soil).NCP=6
    DefaultRGBV(CM_Soil).RGBV=RESHAPE([0.0000000,0.0000000,0.0000000,0.0000000,&
    0.0000000,0.0000000,1.0000000,0.2000000,&
    1.0000000,0.0000000,0.0000000,0.4000000,&
    0.0000000,1.0000000,0.0000000,0.6000000,&
    1.0000000,1.0000000,0.0000000,0.8000000,&
    1.0000000,1.0000000,1.0000000,1.0000000],([4,6]))

    DefaultRGBV(CM_HighPoint2).NAME="HighPoint2"
    DefaultRGBV(CM_HighPoint2).NCP=23
    DefaultRGBV(CM_HighPoint2).RGBV=RESHAPE([0.0000000,1.0000000,0.0000000,0.0000000,&
    0.0000000,1.0000000,0.0000000,0.7230000,&
    0.1490196,1.0000000,0.0000000,0.7230000,&
    0.2980392,1.0000000,0.0000000,0.7320000,&
    0.4470588,1.0000000,0.0000000,0.7410000,&
    0.5960784,1.0000000,0.0000000,0.7500000,&
    0.7450980,1.0000000,0.0000000,0.7590000,&
    0.8980392,1.0000000,0.0000000,0.7680000,&
    1.0000000,0.9529412,0.0000000,0.7770000,&
    1.0000000,0.8039216,0.0000000,0.7860000,&
    1.0000000,0.6549020,0.0000000,0.7950000,&
    1.0000000,0.5019608,0.0000000,0.8040000,&
    1.0000000,0.3529412,0.0000000,0.8130000,&
    1.0000000,0.2039216,0.0000000,0.8210000,&
    1.0000000,0.0549020,0.0000000,0.8300000,&
    0.9019608,0.0000000,0.0000000,0.8390000,&
    0.7529412,0.0000000,0.0000000,0.8480000,&
    0.6039216,0.0000000,0.0000000,0.8570000,&
    0.4509804,0.0000000,0.0000000,0.8660000,&
    0.3019608,0.0000000,0.0000000,0.8750000,&
    0.1529412,0.0000000,0.0000000,0.8840000,&
    0.0000000,0.0000000,0.0000000,0.8930000,&
    0.0000000,0.0000000,0.0000000,1.0000000],([4,23]))

    DefaultRGBV(CM_Terrain).NAME="Terrain"
    DefaultRGBV(CM_Terrain).NCP=21
    DefaultRGBV(CM_Terrain).RGBV=RESHAPE([0.7843137,0.8431373,0.5215686,0.0000000,&
    0.6705882,0.8509804,0.6941176,0.0500000,&
    0.4862745,0.7686275,0.4705882,0.1000000,&
    0.4588235,0.7568627,0.4705882,0.1500000,&
    0.6862745,0.8000000,0.6509804,0.2000000,&
    0.8588235,0.8156863,0.3058824,0.2500000,&
    0.9450980,0.8117647,0.0549020,0.3000000,&
    0.9490196,0.6549020,0.0000000,0.3500000,&
    0.7529412,0.6235294,0.0509804,0.4000000,&
    0.8274510,0.7529412,0.4392157,0.4500000,&
    0.9411765,0.8588235,0.6313725,0.5000000,&
    0.9882353,0.9254902,0.7529412,0.5500000,&
    0.9725490,0.9803922,0.9176471,0.6000000,&
    0.8980392,0.9960784,0.9803922,0.6500000,&
    0.8588235,1.0000000,0.9921569,0.7000000,&
    0.8392157,0.9843137,0.9882353,0.7500000,&
    0.7176471,0.9568627,0.9686275,0.8000000,&
    0.4509804,0.8784314,0.9450980,0.8500000,&
    0.1137255,0.7372549,0.9372549,0.9000000,&
    0.0000000,0.5372549,0.9607843,0.9500000,&
    0.0000000,0.3137255,0.9803922,1.0000000],([4,21]))

    DefaultRGBV(CM_RainBowLight).NAME="RainBowLight"
    DefaultRGBV(CM_RainBowLight).NCP=9
    DefaultRGBV(CM_RainBowLight).RGBV=RESHAPE([0.8000000,0.6000000,0.8000000,0.0000000,&
    0.8000000,0.6000000,1.0000000,0.1674877,&
    0.4000000,0.6000000,1.0000000,0.2807882,&
    0.6000000,1.0000000,1.0000000,0.4334976,&
    0.6000000,1.0000000,0.0000000,0.5566502,&
    0.8000000,1.0000000,0.4000000,0.6650246,&
    1.0000000,1.0000000,0.6000000,0.7881773,&
    1.0000000,0.8000000,0.0000000,0.9211823,&
    1.0000000,0.6000000,0.4000000,1.0000000],([4,9]))

    DefaultRGBV(CM_RainBowPastel).NAME="RainBowPastel"
    DefaultRGBV(CM_RainBowPastel).NCP=8
    DefaultRGBV(CM_RainBowPastel).RGBV=RESHAPE([0.9019608,0.9019608,0.9019608,0.0000000,&
    0.8000000,0.8000000,1.0000000,0.1100000,&
    0.6000000,0.8000000,0.8000000,0.2600000,&
    0.8000000,1.0000000,0.8000000,0.4290000,&
    1.0000000,1.0000000,0.8000000,0.5900000,&
    1.0000000,0.8000000,0.8000000,0.8000000,&
    1.0000000,1.0000000,1.0000000,0.9600000,&
    1.0000000,1.0000000,1.0000000,1.0000000],([4,8]))

    DefaultRGBV(CM_Geology).NAME="Geology"
    DefaultRGBV(CM_Geology).NCP=9
    DefaultRGBV(CM_Geology).RGBV=RESHAPE([0.1686275,0.5137255,0.7294118,0.0000000,&
    0.4000000,0.7607843,0.6470588,0.1142860,&
    0.6705882,0.8666667,0.6431373,0.2428580,&
    0.9019608,0.9607843,0.5960784,0.3714290,&
    1.0000000,1.0000000,0.7490196,0.5000000,&
    0.9960784,0.8784314,0.5450980,0.6238100,&
    0.9921569,0.6823529,0.3803922,0.7523810,&
    0.9568627,0.4274510,0.2627451,0.8761910,&
    0.8431373,0.2392157,0.1607843,1.0000000],([4,9]))

    DefaultRGBV(CM_Land).NAME="Land"
    DefaultRGBV(CM_Land).NCP=6
    DefaultRGBV(CM_Land).RGBV=RESHAPE([0.0000000,1.0000000,0.0000000,0.0000000,&
    0.2000000,0.8000000,0.2000000,0.2120000,&
    0.6000000,0.4000000,0.2000000,0.4580000,&
    1.0000000,1.0000000,0.8000000,0.7540000,&
    1.0000000,1.0000000,1.0000000,0.9010000,&
    0.8000000,0.8000000,1.0000000,1.0000000],([4,6]))


	IsCMIni=.TRUE.
	
END SUBROUTINE



END MODULE

